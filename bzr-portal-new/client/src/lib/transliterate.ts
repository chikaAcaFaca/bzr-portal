/**
 * Функционалност за транслитерацију имена фајлова са ћирилице и латинице са дијакритичким знаковима
 * у енглеску латиницу ради компатибилности приликом отпремања и приказа фајлова
 */

// Мапа за конверзију ћириличних и латиничних карактера
const characterMap: Record<string, string> = {
  // Ћирилична слова
  'А': 'A', 'Б': 'B', 'В': 'V', 'Г': 'G', 'Д': 'D', 'Ђ': 'DJ', 'Е': 'E', 'Ж': 'Z', 
  'З': 'Z', 'И': 'I', 'Ј': 'J', 'К': 'K', 'Л': 'L', 'Љ': 'LJ', 'М': 'M', 'Н': 'N', 
  'Њ': 'NJ', 'О': 'O', 'П': 'P', 'Р': 'R', 'С': 'S', 'Т': 'T', 'Ћ': 'C', 'У': 'U', 
  'Ф': 'F', 'Х': 'H', 'Ц': 'C', 'Ч': 'C', 'Џ': 'DZ', 'Ш': 'S',

  'а': 'a', 'б': 'b', 'в': 'v', 'г': 'g', 'д': 'd', 'ђ': 'dj', 'е': 'e', 'ж': 'z', 
  'з': 'z', 'и': 'i', 'ј': 'j', 'к': 'k', 'л': 'l', 'љ': 'lj', 'м': 'm', 'н': 'n', 
  'њ': 'nj', 'о': 'o', 'п': 'p', 'р': 'r', 'с': 's', 'т': 't', 'ћ': 'c', 'у': 'u', 
  'ф': 'f', 'х': 'h', 'ц': 'c', 'ч': 'c', 'џ': 'dz', 'ш': 's',

  // Латинична слова са дијакритичким знаковима
  'Č': 'C', 'Ć': 'C', 'Đ': 'DJ', 'Š': 'S', 'Ž': 'Z', 
  'č': 'c', 'ć': 'c', 'đ': 'dj', 'š': 's', 'ž': 'z',

  // Додатни дијакритички знакови који се могу појавити
  'Ä': 'A', 'Ö': 'O', 'Ü': 'U', 'ß': 'ss',
  'ä': 'a', 'ö': 'o', 'ü': 'u',
  'Å': 'A', 'å': 'a',
  'Æ': 'AE', 'æ': 'ae',
  'Ø': 'O', 'ø': 'o',
  'Ñ': 'N', 'ñ': 'n',
  'Ç': 'C', 'ç': 'c',
  'Ë': 'E', 'ë': 'e',
  'Ï': 'I', 'ï': 'i',
  'À': 'A', 'Á': 'A', 'Â': 'A', 'Ã': 'A',
  'à': 'a', 'á': 'a', 'â': 'a', 'ã': 'a',
  'È': 'E', 'É': 'E', 'Ê': 'E',
  'è': 'e', 'é': 'e', 'ê': 'e',
  'Ì': 'I', 'Í': 'I', 'Î': 'I',
  'ì': 'i', 'í': 'i', 'î': 'i',
  'Ò': 'O', 'Ó': 'O', 'Ô': 'O', 'Õ': 'O',
  'ò': 'o', 'ó': 'o', 'ô': 'o', 'õ': 'o',
  'Ù': 'U', 'Ú': 'U', 'Û': 'U',
  'ù': 'u', 'ú': 'u', 'û': 'u',
};

/**
 * Функција за транслитерацију текста из ћирилице/латинице са дијакритиком у енглеску латиницу
 * @param text Улазни текст за транслитерацију
 * @returns Транслитерисани текст
 */
export function transliterate(text: string): string {
  return text
    .split('')
    .map(char => characterMap[char] || char)
    .join('');
}

/**
 * Функција за транслитерацију имена фајла, укључујући и екстензију
 * @param fileName Име фајла које треба транслитерисати
 * @returns Транслитерисано име фајла са очуваном екстензијом
 */
export function transliterateFileName(fileName: string): string {
  const lastDotIndex = fileName.lastIndexOf('.');
  
  if (lastDotIndex === -1) {
    // Нема екстензије
    return transliterate(fileName);
  }
  
  const name = fileName.substring(0, lastDotIndex);
  const extension = fileName.substring(lastDotIndex);
  
  return transliterate(name) + extension;
}

/**
 * Функција за проверу да ли име фајла садржи ћириличне или специјалне латиничне карактере
 * @param fileName Име фајла за проверу
 * @returns true ако име фајла садржи специјалне карактере који би требало транслитерисати
 */
export function needsTransliteration(fileName: string): boolean {
  for (const char of fileName) {
    if (characterMap[char]) {
      return true;
    }
  }
  return false;
}